(function(){function S(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=Math.random()}var Q={},s={},Ka=localStorage.getItem("djc:session_id");Ka?s.session_id=Ka:(s.session_id=Math.floor(1E16*Math.random()).toString(),localStorage.setItem("djc:session_id",s.session_id));s.session_id+="-"+Math.floor(1E3*Math.random());s.counter=function(a){var b=localStorage.getItem("djc:"+a),b=parseInt(b||0,10);localStorage.setItem("djc:"+a,(b+1).toString());return b};s.global_timestamp=
function(a,b){var c="gs:"+a,d=parseInt(localStorage.getItem("djc:"+c)||0,10);b&&b>d?(localStorage.setItem("djc:"+c,b.toString()),c=b):c=d;return c};s.node_ctr=function(){return s.counter("node_ctr")};s.message_ctr=function(a){return s.counter("message_ctr:"+a)};s.node_id=function(a){return[s.session_id,a,s.node_ctr()].join("-")};s.message_id=function(a){return[a,s.global_timestamp(a),s.session_id,s.message_ctr(a)]};Q.module$exports=s;Q.module$exports&&(Q=Q.module$exports);var W={},ja={random_string:function(a){for(var b=
[],c=0;c<a;c++)b.push(String.fromCharCode(Math.floor(26*Math.random())+97));return b.join("")}},ka=!1,xa=[],la=function(){if(!ka)for(ka=!0;0<xa.length;)xa.pop()()};if("complete"==document.readyState||"undefined"==typeof document.readyState&&(document.getElementsByTagName("body")[0]||document.body))la();else if(document.addEventListener)document.addEventListener("DOMContentLoaded",la,!1);else if(document.attachEvent){var ya;ya=function(){"complete"==document.readyState&&(la(),document.detachEvent("onreadystatechange",
ya))};document.attachEvent("onreadystatechange",ya)}else{var La;La=setInterval(function(){if(ka||/loaded|complete/.test(document.readyState))la(),clearInterval(La)},10)}ja.onReady=function(a){ka?a():xa.push(a)};ja.create=function(a,b,c,d){if(!d)a:{for(;;)if(d=ja.random_string(10),!document.getElementById(d))break a;d=void 0}b=b||{};c=c||{};b.width=b.width||1;b.height=b.height||1;var h;if((new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).getVariable("$version")){h=document.createElement("div");
h.style.visibility="hidden";h.setAttribute("id",d);var d=[],f;for(f in b)if(b.hasOwnProperty(f))switch(f.toLowerCase()){case "styleclass":d.push(' class="');d.push(b[f]);d.push('"');break;case "classid":d.push(' classid="');d.push(b[f]);d.push('"');break;default:d.push(" "),d.push(f),d.push('="'),d.push(b[f].replace('"',"%22")),d.push('"')}c.movie=a;a=[];for(f in c)c.hasOwnProperty(f)&&(a.push('<param name="'),a.push(f),a.push('" value="'),a.push(c[f]),a.push('"> '));h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+
d.join("")+">"+a.join("")+"</object>";return document.getElementById("id").firstChild}h=document.createEleement("object");h.setAttribute("type","application/x-shockwave-falsh");for(f in b)b.hasOwnProperty(f)&&("styleclass"==f.toLowerCase()?h.setAttribute("class",b[f]):h.setAttribute(f,b[f]));for(f in c)c.hasOwnProperty(f)&&(a=document.createElement("param"),a.setAttribute("name",f),a.setAttribute("value",c[f]),h.appendChild(a));h.style.visibility="hidden";document.body.appendChild(h)};W.module$exports=
ja;W.module$exports&&(W=W.module$exports);var X={},ma={},w=Array.prototype,Ma=Object.prototype,za=w.push,q=w.slice,na=w.concat,Y=Ma.toString,db=Ma.hasOwnProperty,Na=w.forEach,Oa=w.map,Pa=w.reduce,Qa=w.reduceRight,Ra=w.filter,Sa=w.every,Ta=w.some,oa=w.indexOf,Ua=w.lastIndexOf,eb=Array.isArray,fb=Object.keys,Aa=Function.prototype.bind,e=function(a){if(a instanceof e)return a;if(!(this instanceof e))return new e(a);this._wrapped=a};e.VERSION="1.5.1 (hacked for requirejs)";var u=e.each=e.forEach=function(a,
b,c){if(null!=a)if(Na&&a.forEach===Na)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,h=a.length;d<h&&b.call(c,a[d],d,a)!==ma;d++);else for(var f=e.keys(a),d=0,h=f.length;d<h&&b.call(c,a[f[d]],f[d],a)!==ma;d++);};e.map=e.collect=function(a,b,c){var d=[];if(null==a)return d;if(Oa&&a.map===Oa)return a.map(b,c);u(a,function(a,f,e){d.push(b.call(c,a,f,e))});return d};e.reduce=e.foldl=e.inject=function(a,b,c,d){var h=2<arguments.length;null==a&&(a=[]);if(Pa&&a.reduce===Pa)return d&&(b=e.bind(b,
d)),h?a.reduce(b,c):a.reduce(b);u(a,function(a,e,j){h?c=b.call(d,c,a,e,j):(c=a,h=!0)});if(!h)throw new TypeError("Reduce of empty array with no initial value");return c};e.reduceRight=e.foldr=function(a,b,c,d){var h=2<arguments.length;null==a&&(a=[]);if(Qa&&a.reduceRight===Qa)return d&&(b=e.bind(b,d)),h?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f)var p=e.keys(a),f=p.length;u(a,function(e,l,n){l=p?p[--f]:--f;h?c=b.call(d,c,a[l],l,n):(c=a[l],h=!0)});if(!h)throw new TypeError("Reduce of empty array with no initial value");
return c};e.find=e.detect=function(a,b,c){var d;Va(a,function(a,f,e){if(b.call(c,a,f,e))return d=a,!0});return d};e.filter=e.select=function(a,b,c){var d=[];if(null==a)return d;if(Ra&&a.filter===Ra)return a.filter(b,c);u(a,function(a,f,e){b.call(c,a,f,e)&&d.push(a)});return d};e.reject=function(a,b,c){return e.filter(a,function(a,h,f){return!b.call(c,a,h,f)},c)};e.every=e.all=function(a,b,c){b||(b=e.identity);var d=!0;if(null==a)return d;if(Sa&&a.every===Sa)return a.every(b,c);u(a,function(a,f,e){if(!(d=
d&&b.call(c,a,f,e)))return ma});return!!d};var Va=e.some=e.any=function(a,b,c){b||(b=e.identity);var d=!1;if(null==a)return d;if(Ta&&a.some===Ta)return a.some(b,c);u(a,function(a,f,e){if(d||(d=b.call(c,a,f,e)))return ma});return!!d};e.contains=e.include=function(a,b){return null==a?!1:oa&&a.indexOf===oa?-1!=a.indexOf(b):Va(a,function(a){return a===b})};e.invoke=function(a,b){var c=q.call(arguments,2),d=e.isFunction(b);return e.map(a,function(a){return(d?b:a[b]).apply(a,c)})};e.pluck=function(a,b){return e.map(a,
function(a){return a[b]})};e.where=function(a,b,c){return e.isEmpty(b)?c?void 0:[]:e[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})};e.findWhere=function(a,b){return e.where(a,b,!0)};e.max=function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&e.isEmpty(a))return-Infinity;var d={computed:-Infinity,value:-Infinity};u(a,function(a,f,e){f=b?b.call(c,a,f,e):a;f>d.computed&&(d={value:a,computed:f})});return d.value};e.min=
function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&e.isEmpty(a))return Infinity;var d={computed:Infinity,value:Infinity};u(a,function(a,f,e){f=b?b.call(c,a,f,e):a;f<d.computed&&(d={value:a,computed:f})});return d.value};e.shuffle=function(a){var b,c=0,d=[];u(a,function(a){b=e.random(c++);d[c-1]=d[b];d[b]=a});return d};var Ba=function(a){return e.isFunction(a)?a:function(b){return b[a]}};e.sortBy=function(a,b,c){var d=Ba(b);return e.pluck(e.map(a,
function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var Ca=function(a){return function(b,c,d){var h={},f=null==c?e.identity:Ba(c);u(b,function(c,e){var l=f.call(d,c,e,b);a(h,l,c)});return h}};e.groupBy=Ca(function(a,b,c){(e.has(a,b)?a[b]:a[b]=[]).push(c)});e.indexBy=Ca(function(a,b,c){a[b]=c});e.countBy=Ca(function(a,b){e.has(a,b)?a[b]++:
a[b]=1});e.sortedIndex=function(a,b,c,d){for(var c=null==c?e.identity:Ba(c),b=c.call(d,b),h=0,f=a.length;h<f;){var p=h+f>>>1;c.call(d,a[p])<b?h=p+1:f=p}return h};e.toArray=function(a){return!a?[]:e.isArray(a)?q.call(a):a.length===+a.length?e.map(a,e.identity):e.values(a)};e.size=function(a){return null==a?0:a.length===+a.length?a.length:e.keys(a).length};e.first=e.head=e.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:q.call(a,0,b)};e.initial=function(a,b,c){return q.call(a,0,a.length-
(null==b||c?1:b))};e.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:q.call(a,Math.max(a.length-b,0))};e.rest=e.tail=e.drop=function(a,b,c){return q.call(a,null==b||c?1:b)};e.compact=function(a){return e.filter(a,e.identity)};var Wa=function(a,b,c){if(b&&e.every(a,e.isArray))return na.apply(c,a);u(a,function(a){e.isArray(a)||e.isArguments(a)?b?za.apply(c,a):Wa(a,b,c):c.push(a)});return c};e.flatten=function(a,b){return Wa(a,b,[])};e.without=function(a){return e.difference(a,q.call(arguments,
1))};e.uniq=e.unique=function(a,b,c,d){e.isFunction(b)&&(d=c,c=b,b=!1);var c=c?e.map(a,c,d):a,h=[],f=[];u(c,function(c,d){if(b?!d||f[f.length-1]!==c:!e.contains(f,c))f.push(c),h.push(a[d])});return h};e.union=function(){return e.uniq(e.flatten(arguments,!0))};e.intersection=function(a){var b=q.call(arguments,1);return e.filter(e.uniq(a),function(a){return e.every(b,function(b){return 0<=e.indexOf(b,a)})})};e.difference=function(a){var b=na.apply(w,q.call(arguments,1));return e.filter(a,function(a){return!e.contains(b,
a)})};e.zip=function(){for(var a=e.max(e.pluck(arguments,"length").concat(0)),b=Array(a),c=0;c<a;c++)b[c]=e.pluck(arguments,""+c);return b};e.object=function(a,b){if(null==a)return{};for(var c={},d=0,h=a.length;d<h;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c};e.indexOf=function(a,b,c){if(null==a)return-1;var d=0,h=a.length;if(c)if("number"==typeof c)d=0>c?Math.max(0,h+c):c;else return d=e.sortedIndex(a,b),a[d]===b?d:-1;if(oa&&a.indexOf===oa)return a.indexOf(b,c);for(;d<h;d++)if(a[d]===b)return d;
return-1};e.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(Ua&&a.lastIndexOf===Ua)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=d?c:a.length;c--;)if(a[c]===b)return c;return-1};e.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,d=Math.max(Math.ceil((b-a)/c),0),h=0,f=Array(d);h<d;)f[h++]=a,a+=c;return f};var Da=function(){};e.bind=function(a,b){var c,d;if(Aa&&a.bind===Aa)return Aa.apply(a,q.call(arguments,1));if(!e.isFunction(a))throw new TypeError;
c=q.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(b,c.concat(q.call(arguments)));Da.prototype=a.prototype;var h=new Da;Da.prototype=null;var f=a.apply(h,c.concat(q.call(arguments)));return Object(f)===f?f:h}};e.partial=function(a){var b=q.call(arguments,1);return function(){return a.apply(this,b.concat(q.call(arguments)))}};e.bindAll=function(a){var b=q.call(arguments,1);if(0===b.length)throw Error("bindAll must be passed function names");u(b,function(b){a[b]=e.bind(a[b],
a)});return a};e.memoize=function(a,b){var c={};b||(b=e.identity);return function(){var d=b.apply(this,arguments);return e.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}};e.delay=function(a,b){var c=q.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};e.defer=function(a){return e.delay.apply(e,[a,1].concat(q.call(arguments,1)))};e.throttle=function(a,b,c){var d,h,f,e=null,j=0;c||(c={});var l=function(){j=!1===c.leading?0:new Date;e=null;f=a.apply(d,h)};return function(){var n=
new Date;!j&&!1===c.leading&&(j=n);var g=b-(n-j);d=this;h=arguments;0>=g?(clearTimeout(e),e=null,j=n,f=a.apply(d,h)):!e&&!1!==c.trailing&&(e=setTimeout(l,g));return f}};e.debounce=function(a,b,c){var d,h=null;return function(){var f=this,e=arguments,j=c&&!h;clearTimeout(h);h=setTimeout(function(){h=null;c||(d=a.apply(f,e))},b);j&&(d=a.apply(f,e));return d}};e.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;c=a.apply(this,arguments);a=null;return c}};e.wrap=function(a,b){return function(){var c=
[a];za.apply(c,arguments);return b.apply(this,c)}};e.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};e.after=function(a,b){return function(){if(1>--a)return b.apply(this,arguments)}};e.keys=fb||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)e.has(a,c)&&b.push(c);return b};e.values=function(a){for(var b=e.keys(a),c=b.length,d=Array(c),h=0;h<c;h++)d[h]=a[b[h]];return d};e.pairs=
function(a){for(var b=e.keys(a),c=b.length,d=Array(c),h=0;h<c;h++)d[h]=[b[h],a[b[h]]];return d};e.invert=function(a){for(var b={},c=e.keys(a),d=0,h=c.length;d<h;d++)b[a[c[d]]]=c[d];return b};e.functions=e.methods=function(a){var b=[],c;for(c in a)e.isFunction(a[c])&&b.push(c);return b.sort()};e.extend=function(a){u(q.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};e.pick=function(a){var b={},c=na.apply(w,q.call(arguments,1));u(c,function(c){c in a&&(b[c]=a[c])});return b};
e.omit=function(a){var b={},c=na.apply(w,q.call(arguments,1)),d;for(d in a)e.contains(c,d)||(b[d]=a[d]);return b};e.defaults=function(a){u(q.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])});return a};e.clone=function(a){return!e.isObject(a)?a:e.isArray(a)?a.slice():e.extend({},a)};e.tap=function(a,b){b(a);return a};var Ea=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof e&&(a=a._wrapped);b instanceof e&&(b=b._wrapped);var h=
Y.call(a);if(h!=Y.call(b))return!1;switch(h){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var f=a.constructor,p=b.constructor;if(f!==p&&(!e.isFunction(f)||!(f instanceof
f&&e.isFunction(p)&&p instanceof p)))return!1;c.push(a);d.push(b);f=0;p=!0;if("[object Array]"==h){if(f=a.length,p=f==b.length)for(;f--&&(p=Ea(a[f],b[f],c,d)););}else{for(var j in a)if(e.has(a,j)&&(f++,!(p=e.has(b,j)&&Ea(a[j],b[j],c,d))))break;if(p){for(j in b)if(e.has(b,j)&&!f--)break;p=!f}}c.pop();d.pop();return p};e.isEqual=function(a,b){return Ea(a,b,[],[])};e.isEmpty=function(a){if(null==a)return!0;if(e.isArray(a)||e.isString(a))return 0===a.length;for(var b in a)if(e.has(a,b))return!1;return!0};
e.isElement=function(a){return!!(a&&1===a.nodeType)};e.isArray=eb||function(a){return"[object Array]"==Y.call(a)};e.isObject=function(a){return a===Object(a)};u("Arguments Function String Number Date RegExp".split(" "),function(a){e["is"+a]=function(b){return Y.call(b)=="[object "+a+"]"}});e.isArguments(arguments)||(e.isArguments=function(a){return!(!a||!e.has(a,"callee"))});"function"!==typeof/./&&(e.isFunction=function(a){return"function"===typeof a});e.isFinite=function(a){return isFinite(a)&&
!isNaN(parseFloat(a))};e.isNaN=function(a){return e.isNumber(a)&&a!=+a};e.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==Y.call(a)};e.isNull=function(a){return null===a};e.isUndefined=function(a){return void 0===a};e.has=function(a,b){return db.call(a,b)};e.identity=function(a){return a};e.times=function(a,b,c){for(var d=Array(Math.max(0,a)),h=0;h<a;h++)d[h]=b.call(c,h);return d};e.random=function(a,b){null==b&&(b=a,a=0);return a+Math.floor(Math.random()*(b-a+1))};var Z={escape:{"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};Z.unescape=e.invert(Z.escape);var gb={escape:RegExp("["+e.keys(Z.escape).join("")+"]","g"),unescape:RegExp("("+e.keys(Z.unescape).join("|")+")","g")};e.each(["escape","unescape"],function(a){e[a]=function(b){return null==b?"":(""+b).replace(gb[a],function(b){return Z[a][b]})}});e.result=function(a,b){if(null!=a){var c=a[b];return e.isFunction(c)?c.call(a):c}};e.mixin=function(a){u(e.functions(a),function(b){var c=e[b]=a[b];e.prototype[b]=function(){var a=
[this._wrapped];za.apply(a,arguments);a=c.apply(e,a);return this._chain?e(a).chain():a}})};var hb=0;e.uniqueId=function(a){var b=++hb+"";return a?a+b:b};e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Fa=/(.)^/,ib={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},jb=/\\|'|\r|\n|\t|\u2028|\u2029/g;e.template=function(a,b,c){var d,c=e.defaults({},c,e.templateSettings),h=RegExp([(c.escape||Fa).source,(c.interpolate||
Fa).source,(c.evaluate||Fa).source].join("|")+"|$","g"),f=0,p="__p+='";a.replace(h,function(b,c,d,h,e){p+=a.slice(f,e).replace(jb,function(a){return"\\"+ib[a]});c&&(p+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'");d&&(p+="'+\n((__t=("+d+"))==null?'':__t)+\n'");h&&(p+="';\n"+h+"\n__p+='");f=e+b.length;return b});p+="';\n";c.variable||(p="with(obj||{}){\n"+p+"}\n");p="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+p+"return __p;\n";try{d=new Function(c.variable||
"obj","_",p)}catch(j){throw j.source=p,j;}if(b)return d(b,e);b=function(a){return d.call(this,a,e)};b.source="function("+(c.variable||"obj")+"){\n"+p+"}";return b};e.chain=function(a){return e(a).chain()};e.mixin(e);u("pop push reverse shift sort splice unshift".split(" "),function(a){var b=w[a];e.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);("shift"==a||"splice"==a)&&0===c.length&&delete c[0];return this._chain?e(c).chain():c}});u(["concat","join","slice"],function(a){var b=w[a];
e.prototype[a]=function(){var a=b.apply(this._wrapped,arguments);return this._chain?e(a).chain():a}});e.extend(e.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}});X.module$exports=e;X.module$exports&&(X=X.module$exports);var D={},kb=X,pa;if(Object.create)pa=function(a){return Object.create(a)};else{var Ga=function(){};pa=function(a){Ga.prototype=a;a=new Ga;Ga.prototype=null;return a}}var g=pa(kb);g.inherit=pa;g.debug=!1;g.cl=function(){if(g.debug)switch(arguments.length){case 0:console.log();
break;case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;default:console.log(arguments[0],arguments[1],arguments[2])}};g.ct=function(){g.debug&&console.trace()};g.isWindow=function(a){return null!=a&&a===a.window};g.isNumeric=g.isNumber;g.isPlainObject=function(a){if("object"!==typeof a||a.nodeType||g.isWindow(a))return!1;try{if(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0};g.dictMerge=function(a,b){g.each(b,
function(b,d){a[d]=b})};g.arrayMerge=function(a,b,c){var d={},h,f;for(i=0;i<b.length;i++)d[c(b[i])]=i;var e=[];for(i=0;i<a.length;i++)h=a[i],f=c(h),e.push(h),delete d[f];var a=a.length-b.length,j;for(j in d)d.hasOwnProperty(j)&&(c=d[j],h=b[c],c=Math.max(0,c+a),e.splice(c,0,h),a++);return e};g.mapAll=function(a,b,c){var d=[];if(null==a)return d;var h=0,f;for(f=0;f<a.length;f++){var e=a[f].length;e>h&&(h=e)}for(f=0;f<e;f++){for(var h=[],j=0;j<a.length;j++)h.push(a[j][f]);d.push(b.apply(c,h))}return d};
g.stringCompare=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var h=a.charCodeAt(d),f=b.charCodeAt(d);if(h!=f)return h-f}return b.length-a.length};g.noop=function(){};g.identity=function(a){return a};g.gattr=function(a){return function(b){return b[a]}};g.clear=function(a){for(;0<a.length;)a.shift()};g.unsplat=function(a,b){if(b)return function(){for(var c=[],d=g.toArray(arguments),h=0;h<a;h++)c.push(d.shift());c.push(d);return b.apply(this,c)};b=a;return function(){return b(g.toArray(arguments))}};
g.splat=function(a){return function(b){return a.apply(this,b)}};g.dictIsEmpty=g.isEmpty;g.dictIsEqual=g.isEqual;g.truthiness=function(a){switch(a){case 0:case !1:case null:case void 0:return!1;case !0:return!0}if("string"===typeof a)return/[^\s]/.test(a);if(g.isNumeric(a))return!0;if(void 0!==a.length)return 0<a.length;for(var b in a)if(a.hasOwnProperty(b))return!0;return a.nodeType?!0:!1};g.removeWhitespace=function(a){return a.replace(/\s/g,"")};g.whitespaceEqual=function(a,b){return g.truthiness(a)!==
g.truthiness(b)?!1:g.removeWhitespace(a)==g.removeWhitespace(b)};g.future=function(){var a=[],b=[],c=!1,d=!1,h=null,f=function(f,e){d?(c?e:f).apply(h[0],h[1]):(a.push(f),b.push(e))};f.addReader=f;f.fail=function(){if(!d){h=[this,g.toArray(arguments)];for(c=d=!0;0<b.length;)b.shift().apply(this,arguments)}};f.fire=function(){if(!d){h=[this,g.toArray(arguments)];for(d=!0;0<a.length;)a.shift().apply(this,arguments)}};return f};g.multi=function(a){var b=[],c=[],d=0,h=0,f=!1,e=!1,j=function(){f&&!e&&h>=
d&&(e=!0,a(b))},l=function(a,d){b[a]=d;c[a]||(h++,c[a]=!0);j()};return{addValue:function(a){b.push(a);c.push(!0);d++;h++},getCallback:function(){if(f)return g.noop;var a=d;b.push(null);c.push(!1);d++;return g.partial(l,a)},start:function(){f=!0;j()}}};g.pipe=function(){var a=[],b=[],c=!1,d=function(a){for(var c=0;c<b.length;c++){var d=b[c];d&&d(a)}};return{setLocked:function(h){var f=c;if((c=h)&&!f&&g.some(b))for(;0<a.length;)d(a.shift())},addReader:function(d){var f=b.length;b.push(d);if(!c)for(;0<
a.length;)d(a.shift());return f},buffer:a,removeReader:function(a){b[a]=null},write:function(h){!c&&g.some(b)?d(h):a.push(h)}}};g.maybe_function=function(a){return"function"===typeof a?a:function(){return a}};g.uniqueDebounce=function(a,b){b||(b=100);var c=!1,d=[],h=function(){for(;0<d.length;)a(d.shift());c=!1};return function(a){c||(c=!0,setTimeout(h,b));g.contains(d,a)||d.push(a)}};g.awaiter=function(a,b){return function(){var c=!1,d=function(){c||(b.apply(this,arguments),c=!0)};setTimeout(a,d);
return d}};g.reTester=function(a){return function(b){return a.test(b)}};g.hasOnlyKeys=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&-1==g.indexOf(b,c))return!1;return!0};g.clean=function(a){return g.filter(a,g.truthiness)};var lb=/-([\da-z])/gi,mb=function(a,b){return b.toUpperCase()};g.camelCase=function(a){return a.replace(rmsPrefix,"ms-").replace(lb,mb)};g.replace=function(a,b){for(var c=0;c<a.length;c++){var d=b(a[c]);!1!==d&&(a[c]=d)}};g.indexOf=function(a,b,c,d){d="undefined"==typeof d?
0:d;if(c)for(d;d<a.length;d++){if(c(b,a[d]))return d}else{if(a.indexOf&&0===d)return a.indexOf(b);for(d;d<a.length;d++)if(a[d]==b)return d}return-1};var nb=/(<[^>]*>|[^\w\s]+)/;g.sentenceSplit=function(a){for(var b=a.split(nb),a=[],c=0;c<b.length;c++){var d=b[c];0===c%2?a.push(d):a[a.length-1]+=d}b=0;d=[];for(c=0;c<a.length;c++)d.push(b),b+=a[c].length;return[a,d]};g.withErrback=function(a,b){return function(){try{return a.apply(this,arguments)}catch(c){return b.apply(c,arguments)}}};g.logError=function(a,
b,c){console&&console.error(a,b,c)};g.logsErrors=function(a){return function(){try{return a.apply(this,arguments)}catch(b){g.logError(this,b,arguments)}}};g.errorizeParams=function(a){var b={},c,d;for(d in a)a.hasOwnProperty(d)&&(c=a[d],b[d]="function"==typeof c?g.logsErrors(c):c);return b};g.throttle=function(a,b,c){var d,h,f,e=null,j=0;c||(c={});var l=function(){j=!1===c.leading?0:new Date;e=null;f=a.apply(d,h)};return function(){var n=new Date;!j&&!1===c.leading&&(j=n);var g=b-(n-j);d=this;h=arguments;
0>=g?(clearTimeout(e),e=null,j=n,f=a.apply(d,h)):!e&&!1!==c.trailing&&(e=setTimeout(l,g));return f}};g.extend=function(){var a,b,c,d,h,f=arguments[0]||{},e=1,j=arguments.length,l=!1;"boolean"===typeof f&&(l=f,f=arguments[1]||{},e=2);"object"!==typeof f&&!g.isFunction(f)&&(f={});for(j===e&&(f=this,--e);e<j;e++)if(null!=(a=arguments[e]))for(b in a)c=f[b],d=a[b],f!==d&&(l&&d&&(g.isPlainObject(d)||(h=g.isArray(d)))?(h?(h=!1,c=c&&g.isArray(c)?c:[]):c=c&&g.isPlainObject(c)?c:{},f[b]=g.extend(l,c,d)):void 0!==
d&&(f[b]=d));return f};D.module$exports=g;D.module$exports&&(D=D.module$exports);var J={},K=D,ob=/\S/;S.uid=1;S.accepts=function(a){try{return a.nodeType?1===a.nodeType||9===a.nodeType:!0}catch(b){}};S.prototype={acceptData:function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0},key:function(a){if(!S.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=S.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,K.extend(a,b)}}this.cache[c]||(this.cache[c]=
{});return c},set:function(a,b,c){var d,a=this.key(a),h=this.cache[a];if("string"===typeof b)h[b]=c;else if(K.isEmptyObject(h))K.extend(this.cache[a],b);else for(d in b)h[d]=b[d];return h},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){if(void 0===b||b&&"string"===typeof b&&void 0===c)return c=this.get(a,b),void 0!==c?c:this.get(a,K.camelCase(b));this.set(a,b,c);return void 0!==c?c:b},remove:function(a,b){var c,d;c=this.key(a);var h=this.cache[c];
if(void 0===b)this.cache[c]={};else{K.isArray(b)?d=b.concat(b.map(K.camelCase)):(c=K.camelCase(b),b in h?d=[b,c]:(d=c,d=d in h?[d]:d.match(ob)||[]));for(c=d.length;c--;)delete h[d[c]]}},hasData:function(a){return!K.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};J.module$exports=new S;J.module$exports&&(J=J.module$exports);var aa={},pb={" ":!0,"\t":!0,"\n":!0,"\f":!0,"\r":!0},A;A={defaultJunkFunction:function(a){return pb.hasOwnProperty(a)},
stripLinebreaks:function(a){return a.replace(/^[\n\r]*|[\n\r]*$/g,"")},stringAsLines:function(a){for(var b=a.indexOf("\n"),c=a.indexOf("\r"),a=a.split(-1<b&&-1<c||0>c?"\n":"\r"),b=0;b<a.length;b++)a[b]=A.stripLinebreaks(a[b]);return a},__reduce:function(a,b,c){if(null!=c)var d=0;else if(b)c=b[0],d=1;else return null;for(;d<b.length;d++)c=a(c,b[d]);return c},__ntuplecomp:function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){if(a[d]<b[d])return-1;if(a[d]>b[d])return 1}return a.length==b.length?
0:a.length<b.length?-1:1},__calculate_ratio:function(a,b){return b?2*a/b:1},__isindict:function(a){return function(b){return a.hasOwnProperty(b)}},__dictget:function(a,b,c){return a.hasOwnProperty(b)?a[b]:c},SequenceMatcher:function(a,b,c){this.set_seqs=function(a,b){this.set_seq1(a);this.set_seq2(b)};this.set_seq1=function(a){a!=this.a&&(this.a=a,this.matching_blocks=this.opcodes=null)};this.set_seq2=function(a){a!=this.b&&(this.b=a,this.matching_blocks=this.opcodes=this.fullbcount=null,this.__chain_b())};
this.__chain_b=function(){for(var a=this.b,b=a.length,c=this.b2j={},e={},j=0;j<a.length;j++){var l=a[j];if(c.hasOwnProperty(l)){var n=c[l];200<=b&&100*n.length>b?(e[l]=1,delete c[l]):n.push(j)}else c[l]=[j]}for(l in e)e.hasOwnProperty(l)&&delete c[l];a=this.isjunk;b={};if(a){for(l in e)e.hasOwnProperty(l)&&a(l)&&(b[l]=1,delete e[l]);for(l in c)c.hasOwnProperty(l)&&a(l)&&(b[l]=1,delete c[l])}this.isbjunk=A.__isindict(b);this.isbpopular=A.__isindict(e)};this.find_longest_match=function(a,b,c,e){for(var j=
this.a,l=this.b,n=this.b2j,g=this.isbjunk,x=a,r=c,t=0,m=null,q={},u=[],s=a;s<b;s++){var Xa={},v=A.__dictget(n,j[s],u),w;for(w in v)if(v.hasOwnProperty(w)&&(m=v[w],!(m<c))){if(m>=e)break;Xa[m]=k=A.__dictget(q,m-1,0)+1;k>t&&(x=s-k+1,r=m-k+1,t=k)}q=Xa}for(;x>a&&r>c&&!g(l[r-1])&&j[x-1]==l[r-1];)x--,r--,t++;for(;x+t<b&&r+t<e&&!g(l[r+t])&&j[x+t]==l[r+t];)t++;for(;x>a&&r>c&&g(l[r-1])&&j[x-1]==l[r-1];)x--,r--,t++;for(;x+t<b&&r+t<e&&g(l[r+t])&&j[x+t]==l[r+t];)t++;return[x,r,t]};this.get_matching_blocks=function(){if(null!=
this.matching_blocks)return this.matching_blocks;for(var a=this.a.length,b=this.b.length,c=[[0,a,0,b]],e=[],j,l,n,g,m,r,t,ba;c.length;)if(g=c.pop(),j=g[0],l=g[1],n=g[2],g=g[3],ba=this.find_longest_match(j,l,n,g),m=ba[0],r=ba[1],t=ba[2])e.push(ba),j<m&&n<r&&c.push([j,m,n,r]),m+t<l&&r+t<g&&c.push([m+t,l,r+t,g]);e.sort(A.__ntuplecomp);c=j1=k1=block=0;j=[];for(var q in e)e.hasOwnProperty(q)&&(block=e[q],i2=block[0],j2=block[1],k2=block[2],c+k1==i2&&j1+k1==j2?k1+=k2:(k1&&j.push([c,j1,k1]),c=i2,j1=j2,k1=
k2));k1&&j.push([c,j1,k1]);j.push([a,b,0]);return this.matching_blocks=j};this.get_opcodes=function(){if(null!=this.opcodes)return this.opcodes;var a=0,b=0,c=[];this.opcodes=c;var e,j,l,n,g=this.get_matching_blocks(),m;for(m in g)g.hasOwnProperty(m)&&(e=g[m],j=e[0],l=e[1],e=e[2],n="",a<j&&b<l?n="replace":a<j?n="delete":b<l&&(n="insert"),n&&c.push([n,a,j,b,l]),a=j+e,b=l+e,e&&c.push(["equal",j,a,l,b]));return c};this.get_grouped_opcodes=function(a){a||(a=3);var b=this.get_opcodes();b||(b=[["equal",
0,1,0,1]]);var c,e,j,l,n;"equal"==b[0][0]&&(c=b[0],e=c[0],j=c[1],l=c[2],n=c[3],c=c[4],b[0]=[e,Math.max(j,l-a),l,Math.max(n,c-a),c]);"equal"==b[b.length-1][0]&&(c=b[b.length-1],e=c[0],j=c[1],l=c[2],n=c[3],c=c[4],b[b.length-1]=[e,j,Math.min(l,j+a),n,Math.min(c,n+a)]);var g=a+a,m=[],r;for(r in b)b.hasOwnProperty(r)&&(c=b[r],e=c[0],j=c[1],l=c[2],n=c[3],c=c[4],"equal"==e&&l-j>g&&(m.push([e,j,Math.min(l,j+a),n,Math.min(c,n+a)]),j=Math.max(j,l-a),n=Math.max(n,c-a)),m.push([e,j,l,n,c]));m&&"equal"==m[m.length-
1][0]&&m.pop();return m};this.ratio=function(){matches=A.__reduce(function(a,b){return a+b[b.length-1]},this.get_matching_blocks(),0);return A.__calculate_ratio(matches,this.a.length+this.b.length)};this.quick_ratio=function(){var a,b;if(null==this.fullbcount){this.fullbcount=a={};for(var c=0;c<this.b.length;c++)b=this.b[c],a[b]=A.__dictget(a,b,0)+1}a=this.fullbcount;for(var e={},j=A.__isindict(e),l=numb=0,c=0;c<this.a.length;c++)b=this.a[c],numb=j(b)?e[b]:A.__dictget(a,b,0),e[b]=numb-1,0<numb&&l++;
return A.__calculate_ratio(l,this.a.length+this.b.length)};this.real_quick_ratio=function(){var a=this.a.length,b=this.b.length;return _calculate_ratio(Math.min(a,b),a+b)};this.isjunk=c?c:A.defaultJunkFunction;this.a=this.b=null;this.set_seqs(a,b)}};aa.module$exports=A;aa.module$exports&&(aa=aa.module$exports);var L={},E=D,qa=J,qb=Q,v={traverse:function(a,b){if(a){if(a.nodeType==Node.ELEMENT_NODE&&!1===b(a))return!1;for(var c=v.getChildNodes(a),d=0;d<c.length;d++)c[d].nodeType==Node.ELEMENT_NODE&&
v.traverse(c[d],b)}},nodeCompare:function(a,b){return a==b?!0:a.nodeType!=b.nodeType?!1:a.nodeType==Node.TEXT_NODE?a.data==b.data:!1},stringifyNode:function(a){return a.nodeType==Node.TEXT_NODE?"t:"+a.data:a.nodeType==Node.ELEMENT_NODE?v.get_node_id(a):""},nodeParentIndex:function(a){var b=a.parentNode,a=E.indexOf(v.getChildNodes(b),a);return[b,a]},elementParentIndex:function(a){var b=a.parentNode,c=v.getChildNodes(b),a=E.indexOf(E.filter(c,v.isElement),a);return[b,a]},isElement:function(a){return a.nodeType==
Node.ELEMENT_NODE},isTextNode:function(a){return!!(a&&a.nodeType===Node.TEXT_NODE)},iterAttributes:function(a,b){for(var c=0;c<a.attributes.length;c++)void 0===c.name||void 0===c.value||b(c.name,c.value)},updateAttributes:function(a,b,c){var d=[];v.iterAttributes(a,function(c,e){b[c]?b[c]!=e&&a.setAttribute(c,e):a.removeAttribute(c);d.push(c)});E.each(b,function(b,c){-1==E.indexOf(d)&&a.setAttribute(c,b)});E.each(c,function(b,c){a.removeAttribute(c)})},removeAllAttributes:function(a){var b=[];v.iterAttributes(a,
function(a){b.push(a)});E.each(b,function(b){a.removeAttribute(b)})},setAttributes:function(a,b){E.each(b,function(b,d){a.setAttribute(d,b)})},setIdClass:function(a,b){if(a.nodeType==Node.ELEMENT_NODE){var c=a.getAttribute("class");c?(c=E.filter(c.split(/\s+/g),function(a){return!/^dynajot-/.test(a)}),res=c.join(" ")):c=[];c.push("dynajot-"+b);a.setAttribute("class",c.join(" "))}},toFragment:function(a){var b=document.createDocumentFragment(),c;for(c=0;c<a.length;c++)b.appendChild(a[c]);return b},
isValidNode:function(a){return a.nodeType==Node.ELEMENT_NODE?!0:a.nodeType==Node.TEXT_NODE?!/^\s*$/.test(a.data):!1},getChildNodes:function(a){return a?E.filter(a.childNodes,v.isValidNode):[]},removeAllChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},mergeChildren:function(a,b){v.removeAllChildren(a);var c=v.toFragment(b);a.appendChild(c)},spliceNodes:function(a,b,c,d){for(var e=E.filter(v.getChildNodes(a),function(a){return-1===E.indexOf(d,a)}),f=v.toFragment(d);b<Math.min(c,
e.length);b++)e[b]&&a.removeChild(e[b]);(c=e[c])?a.insertBefore(f,c):a.appendChild(f)},yankNode:function(a){a.parentNode&&a.parentNode.removeChild(a)},insertNodeAt:function(a,b,c){a.firstChild||a.appendChild(b);if(c=a.childNodes[c])if(c.nodeType==Node.ELEMENT_NODE)a.insertBefore(b,c);else{var d=document.createDocumentFragment();for(d.appendChild(b);c&&c.nodeType!=Node.ELEMENT_NODE;)b=c.nextSibling,a.removeChild(c),d.appendChild(c),c=b;c?a.insertBefore(d,c):a.appendChild(d)}else a.appendChild(b)},
isChildOf:function(a,b){for(var c=b;c&&c!=document;){if(c.parentNode==a)return!0;c=c.parentNode}return!1},getNodeById:function(a){var b=qa.get(a,"node_id");if(b)return b;a=a.getAttribute("class");if(!a)return null;a=E.filter(a.split(),E.reTester(/^dynajot-.*/));return 0<a.length?a[0]:null},set_node_id:function(a,b){qa.set(a,"node_id",b);v.setIdClass(a,b)},assign_node_id:function(a,b,c){if(b==a)return"_root";if(a=qa.get(b,"node_id"))return a;c=qb.node_id(c);v.set_node_id(b,c);return c},assign_all_ids:function(a,
b,c){v.traverse(b,function(b){v.assign_node_id(a,b,c)})},get_node_id:function(a){return qa.get(a,"node_id")}};L.module$exports=v;L.module$exports&&(L=L.module$exports);var ca={},rb=D,G={id:"dj-cursor-stable",user:{},send_fn:null},sb={generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}},sa={createCursor:function(a){var a=['<div id="dj-presence-mouse-'+a.id+'" class="dj-mouse">','<div class="dj-filler-wrap">',
'<div class="dj-filler">'+a.name+"</div>","</div></div>"].join(""),b=$("div");b.html(a);$("#"+G.id).append(b);return b},getOrCreateCursor:function(a){($cursor=ra[a.id])||($cursor=sa.createCursor(a),ra[a.id]=$cursor);return $cursor}},ra={};G.init=function(a){G.send_fn=a;a=document.createElement("div");a.id=G.id;a.css="position: absolute; top:0; left:0;";document.body.appendChild(a);a=prompt("What is your name?");G.user={name:a,id:sb.generateUUID()};G.send_fn({kind:"mouse_position",value:{mouse_position:{enter:!0},
user:G.user}});$("body").on("mousemove",rb.throttle(function(a){G.send_fn({kind:"mouse_position",value:{mouse_position:{mousemove:{coords:[a.pageX,a.pageY]}},user:{name:G.user.name,id:G.user.id}}})},75))};G.updateCursors=function(a){var a=JSON.parse(a.data),b,c,d;"mouse_position"===a.kind&&(a=a.value,a.action.enter&&(c=sa.createCursor(a.user),ra[a.user.id]=c),a.action.leave&&(sa.removeUserCursor(a.user),delete ra[a.user.id]),a.action.mousemove&&(b=a.action.mousemove.coords,c=b[0],b=b[1],d=sa.getOrCreateCursor(a.user),
d.css({top:b,left:c}),d.find(".dj-filler").text(a.user.name)))};ca.module$exports=G;ca.module$exports&&(ca=ca.module$exports);var da={},Ha=L,tb=D;da.module$exports={throttledPoll:function(){},onChange:function(a,b,c){var d,e,f=!1,g=function(){f||(clearInterval(c),d&&d.disconnect(),e&&a.removeEventListener("DOMSubtreeModified",e),f=!0)},j=tb.uniqueDebounce(function(a){!1===b(a)&&g()},c),l=function(b){f||Ha.isChildOf(b,a)||j(b)},n=function(b){Ha.traverse(b==a||!b.parentNode?b:b.parentNode,l)};"undefined"!==
typeof MutationObserver?(d=new MutationObserver(function(a){if(!f)for(var b=0;b<a.length;b++)n(a[b].target)}),d.observe(a,{childList:!0,attributes:!0,characterData:!0,subtree:!0})):e=function(b){f||n(b.target||a)};var m=Date.now(),x=function(){f||(Ha.traverse(a,l),setTimeout(x,Date.now()-m),m=Date.now())};setTimeout(x,100);return{stop:g}}};da.module$exports&&(da=da.module$exports);var R={},y=D,I=J,H=L,ub=aa,vb=da,z={},wb={onclick:!0,ondblclick:!0,onmousedown:!0,onmouseup:!0,onmouseover:!0,onmousemove:!0,
onmouseout:!0,ondragstart:!0,ondrag:!0,ondragenter:!0,ondragleave:!0,ondragover:!0,ondrop:!0,ondragend:!0,onkeydown:!0,onkeypress:!0,onkeyup:!0,onload:!0,onunload:!0,onabort:!0,onerror:!0,onresize:!0,onscroll:!0,onselect:!0,onchange:!0,onsubmit:!0,onreset:!0,onfocus:!0,onblur:!0};z.serializeNode=function(a,b,c){if(!b||b!=a&&!b.parentNode)return{};var d={};if(H.isTextNode(b))return z.serializeNode(a,b.parent,c);d.attrs={};if(b.hasAttributes())for(var e=0;e<b.attributes.length;e++){var f=b.attributes[e].name,
g=b.attributes[e].value;if(!wb.hasOwnProperty(f.toLowerCase())&&!("class"==f&&(g=g.replace(/dynajot-[^\s]*/g,""),g=g.replace(/\s+/g," "),g=g.trim(),0===g.length)))d.attrs[f]=g}d.name=b.tagName.toLowerCase();d.children=y.map(H.getChildNodes(b),function(b){return H.isTextNode(b)?{kind:"text",value:b.data}:{kind:"id",value:H.assign_node_id(a,b,c)}});d.position=b==a||!b.parentNode?null:{parent:H.assign_node_id(a,b.parentNode,c),index:H.nodeParentIndex(b)[1]};d.id=H.assign_node_id(a,b,c);return d};z.updateState=
function(a,b,c){if(!H.isTextNode(b)){var d=b.getAttribute("data-id");d&&(H.set_node_id(b,d),b.removeAttribute("data-id"));a=z.serializeNode(a,b,c);I.set(b,"state",a);return a}};z.mergeDeltas=function(a,b){b=y.clone(b);b.attrs&&(a.attrs||(a.attrs={}),y.dictMerge(a.attrs,b.attrs));b.position&&(a.position=y.inherit(b.position));b.message_id&&(a.message_id=b.message_id);b.children&&(a.children&&0<a.children.length?Array.prototype.push.apply(a.children,b.children):a.children=b.children)};z.sentenceDiff=
function(a,b){for(var c=y.sentenceSplit(a),d=y.sentenceSplit(b),e=c[1],d=d[0],c=(new ub.SequenceMatcher(c[0],d)).get_opcodes(),f=[],g=0;g<c.length;g++){var j=c[1],l=c[2],n=c[3],m=c[4];switch(c[0]){case "replace":f.push({action:"replace",start:e[j],end:e[l],value:d.slice(n,m).join("")});break;case "delete":f.push({action:"delete",start:e[j],end:e[l],value:null});break;case "insert":f.push({action:"insert",start:e[j],end:e[l],valie:d.slice(n,m).join("")})}}return f};z.patch=function(a,b){var c=a,d=
0;b.sort(function(a,b){return a.start-b.start});for(var e=0;e<b.length;e++){var f=b[e];switch(f.action){case "replace":c=c.slice(0,d+f.start)+f.value+c.slice(d+f.end);d+=f.end-f.start+f.value.length;break;case "delete":c=c.slice(0,d+f.start)+c.slice(d+f.end);d-=f.end-f.start;break;case "insert":c=c.slice(0,d+f.start)+f.value+a.slice(d+f.start),d+=f.value.length}}return c};z.delta=function(a,b){var c=y.clone(b);c.removed_children=y.filter(a.children,function(a){return-1==y.indexOf(b.children,a,y.isEqual)});
c.removed_attrs={};y.each(a.attrs,function(a,e){e in b.attrs||(c.removed_attrs[e]=a)});return c};z.nodeTransactions=function(a,b,c,d){y.each(b,function(a){I.set(a,"dirty",!0)});d();y.each(b,function(b){z.updateState(a,b,c);I.set(b,"dirty",!1)})};z.nodeTransaction=function(a,b,c,d){b.parentNode?(I.set(b,"dirty",!0),d(I.get(b,"state"),b),z.updateState(a,b,c),I.set(b,"dirty",!1)):d({},b)};z.changes=function(a,b,c){var d=function(e){var f=!1;H.isTextNode(e)&&(e=e.parentNode);if(e)if(I.get(e,"dirty"))setTimeout(y.partial(d,
e),200);else{var g=I.get(e,"state"),j=z.serializeNode(a,e,b);if(y.truthiness(j)&&(g?y.isEqual(g,j)||(f=!1===c(z.delta(g,j))):f=!1===c(j),I.set(e,"state",j),f))return!1}};return vb.onChange(a,d,200)};R.module$exports=z;R.module$exports&&(R=R.module$exports);var ta={},B=D,m={t:{}};m.t.array=B.isArray;m.t.element=B.isElement;m.t.fn=B.isFunction;m.t.string=B.isString;m.t.number=B.isNumber;m.t.bool=B.isBoolean;m.t.dict=B.isObject;m.t.any=function(a){return function(b){return B.every(b,B.partial(m.validate,
a))}};m.t.nullable=function(a){return function(b){return null===b?!0:m.validate(a,b)}};m.errback=function(){console.trace()};m.validate=function(a,b){if(a==b)return!0;if("function"==typeof a)return a(b);if(typeof a!=typeof b||B.isArray(a)!=B.isArray(b)||B.isObject(a)!=B.isObject(b))return!1;var c=!0;B.each(b,function(b,e){var f=a[e];if(!f||!m.validate(f,b))return c=!1});if(!c)return c;B.each(a,function(a,e){if(!(e in b))return c=!1});return c};m.inp_validated=function(a,b,c){c||(c=m.errback);return function(d){m.validate(a,
d)||c(b,a,d);return b(d)}};m.outp_validated=function(a,b,c){c||(c=m.errback);return function(){var d=b.apply(this,arguments);m.validate(a,d)||c(b,a,d);return d}};m.Delta={id:m.t.string,name:m.t.string,message_id:m.t.nullable([m.t.string,m.t.number,m.t.string,m.t.number]),attrs:{"+":m.t.dict,"-":m.t.dict},position:m.t.nullable({parent:m.t.string,offset:m.t.number}),children:m.t.any({kind:m.t.string,value:m.t.string})};m.Element={id:m.t.string,attrs:m.t.dict,position:{parent:m.t.string,index:m.t.number},
children:m.t.any({kind:m.t.string,value:m.t.string})};ta.module$exports=m;ta.module$exports&&(ta=ta.module$exports);var ea={},M=D,N=L,xb=R,ua=J,F={},Ya={};F.getNode=function(a,b){var c;(c="_root"===b?a:a.querySelector(".dynajot-"+b))?Ya[b]=c:c=Ya[b]||null;return c};F.resolveNode=function(a,b){return"text"==b.kind?document.createTextNode(b.value):F.getNode(a,b.value)};F.insertionIndex=function(a,b){var c=ua.get(a,"children_resolved");if(!c)return b;for(var d=0,e=0;e<b;e++)c[e]||d++;return b-d};F.insertChildNodeAt=
function(a,b,c){var d=ua.get(a,"children_resolved"),e=d?F.insertionIndex(a,c):c;N.insertNodeAt(a,b,e);d&&(d[c]=!0,ua.set(a,"children_resolved",d))};F.appliesDeltas=function(a,b,c){var d,e={},f=function(a,b){d(b);for(var c=e[a];c&&0<c.length;)c.shift()(b);delete e[a]},g=M.partial(F.resolveNode,a);return d=function(d){var l=F.getNode(a,d.id),n=function(c){var e=function(a,b,c){var c=c||[],b=M.map(b,g),d=M.map(b,M.truthiness);ua.set(a,"children_resolved",d);return N.mergeChildren(a,M.clean(b),c)},f=
[];l&&f.push(l);c&&f.push(c);xb.nodeTransactions(a,f,b,function(){if(l){M.cl("existing");if(c&&c!=a){var b=N.get_node_id(l.parentNode),f=N.nodeParentIndex(l)[1];if(d.position.parent!=b||d.position.index!=f)N.yankNode(l),F.insertChildNodeAt(c,l,d.position.index)}d.attrs&&N.updateAttributes(l,d.attrs,d.removed_attrs);d.children&&e(l,d.children,d.removed_children)}else M.cl("new",d.id,F.getNode(a,d.id)),b=document.createElement(d.name),d.attrs&&N.updateAttributes(b,d.attrs),d.children&&e(b,d.children),
N.set_node_id(b,d.id),F.insertChildNodeAt(c,b,d.position.index)})};if(d.position){var m=d.position.parent,x=F.getNode(a,m);x?n(x):e[m]?e[m].push(n):(c(m,M.partial(f,m)),e[m]=[n])}else n(null)}};ea.module$exports=F;ea.module$exports&&(ea=ea.module$exports);var fa={},Ia=W,O=D,Za={},$a=function(a){var b=50;return function(){setTimeout(a,b);1E3>b&&(b*=2)}};if(window.WebSocket)Za.connect=function(a){var a=O.maybe_function(a),b,c=O.pipe(),d=O.future(),e=[],f=!1,g=!1,j,l;j=function(){b=new WebSocket(a());
b.onopen=function(){var a=g;for(g=!0;0<e.length&&1===b.readyState;)b.send(JSON.stringify(e.shift()));a||d.fire()};b.onerror=function(){1!==b.readyState&&(b.close(),l())};b.onmessage=function(a){a=JSON.parse(a.data);O.isArray(a)?O.each(c.write,a):c.write(a)};b.onclose=function(){g=!1;f||l()}};l=$a(j);j();return{send:function(a){var c=JSON.stringify(a);if(f)return!1;g&&1===b.readyState?b.send(c):e.push(a)},onOpen:d,removeOpenCallback:d.remove,onMessage:c.addReader,removeMessageCallback:c.removeReader,
close:function(){f=!0;b.close()}}};else{var va;a:{for(;;){var ab=Ia.random_string(10);if(!(ab in window)){va=ab;break a}}va=void 0}var T=null,bb=!1,U=[];window[va]=function(a){if("load"==a)for(bb=!0;0<U.length;)U.shift()(T);else U[a.webSocketId](a)};Ia.onReady(function(){T=Ia.create("/WebSocketMainInsecure.swf",{},{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always",flashVars:"callbackName=window."+va})});soket.connect=function(a){var a=O.maybe_function(a),b=U.length,c=O.pipe(),d=O.future(),
e=[],f=!1,g=!1,j=function(){var c=function(c){c.create(b,a(),[])};bb?c(T):U.push(c)},l=$a(j);U.push(function(a){switch(a.type){case "message":a=decodeURIComponent(a.message);c.write(JSON.parse(a));break;case "close":f||l();break;case "open":for(g=!0;0<e.length;)T.send(b,JSON.stringify(e.shift()));d.fire()}});j();return{send:function(a){if(f)return!1;g?T.send(b,JSON.stringify(a)):e.push(a)},onOpen:d,removeOpenCallback:d.remove,onMessage:c.addReader,removeMessageCallback:c.removeReader,close:function(){f=
!0;g&&T.close(b)}}}}fa.module$exports=Za;fa.module$exports&&(fa=fa.module$exports);var ga={},yb=Q,V=D,zb=R;ga.module$exports={make:function(a){var b=[],c,d={_locals:{}};d._locals.sequence=b;var e=function(a,b){return f(a.message_id,b.message_id)},f=function(a,b){return a[1]!=b[1]?a[1]-b[1]:a[2]!=b[2]?V.stringCompare(a[2],b[2]):a[3]-b[3]};d._locals.compareDeltas=e;var g=function(a){if(0===b.length)return 0;if(1===b.length)return 0<e(a,b[0])?1:0;var c=0,d=b.length;if(0<=e(a,b[d-1]))return d;for(;d>
c&&0<=c;){var f=c+Math.round((d-c)/2),g=e(a,b[f]);if(0===g)return f;if(f>=d)return d;0<g?c=f:d=f}return c};d._locals.insertionPoint=g;var j=function(a){var a=V.groupBy(a,V.gattr("id")),b={},c;for(c in a)if(a.hasOwnProperty(c)){for(var d=a[c],e=V.inherit(d[0]),f=1;f<d.length;f++)zb.mergeDeltas(e,d[f]);b[c]=e}return V.values(b)};d._locals.mergeDeltas=j;d.addDelta=function(d){d=V.inherit(d);d.message_id||(d.message_id=yb.message_id(a));var e=g(d);b.splice(e,0,d);if(c&&0<f(c,d.message_id))return c=d.message_id,
[];c=d.message_id;return b.slice(e)};d.changeset=function(a){a=d.addDelta(a);return j(a)};return d}};ga.module$exports&&(ga=ga.module$exports);var ha={},C=D,Ab=fa,wa=R,Bb=ea,P=L,Cb=ga,cb=ca,Ja=Q,Db=J,ia={DEVELOP_MODE:!1};/localhost/.test(window.location.href)&&(ia.DEVELOP_MODE=!0);ia.sync=function(a,b){var b=C.errorizeParams(b||{}),c=b.document_id,d=b.onDocumentId,e=window.location.hash.slice(1).trim();!c&&C.truthiness(e)&&(c=e);var f;f=ia.url_prefix?ia.url_prefix:"ws://"+window.location.host+"/doc/";
var g,j=Ab.connect(function(){return c?f+c:f}),e={document_id:C.pipe(),document_state:C.pipe(),message:C.pipe(),response:C.pipe()},l=0,m={};e.response.addReader(function(a){var b=a.id;m[b](a.value);delete m[b]});var q=function(a,b){var c=l;l++;m[c]=function(c){"error"==c.kind&&404==c.value?setTimeout(C.partial(q,a,b),500):b(c)};j.send({kind:"request",value:{resource:"/nodes/"+a,id:c}})},s={delta:C.pipe(),mouse_position:C.pipe()},r=function(a){return function(b){console.log(JSON.stringify(b));a[b.kind]&&
a[b.kind].write(b.value)}};j.onMessage(r(e));e.message.addReader(r(s));e.message.addReader(function(a){a.global_timestamp&&Ja.global_timestamp(c,a.global_timestamp)});e.document_id.addReader(function(a){c=a;a.global_timestamp&&Ja.global_timestamp(c,a.global_timestamp);"function"===typeof d?d(c):window.location.hash=c});b.cursors&&(cb.init(j.send),s.mouse_position.addReader(cb.updateCursors));e.document_state.addReader(C.once(function(d){g=Cb.make(c);if(d){var e=document.createElement("div");e.innerHTML=
d;d=e.firstChild;for(P.removeAllChildren(a);;){e=d.firstChild;if(!e)break;d.removeChild(e);a.appendChild(e)}P.removeAllAttributes(a);P.iterAttributes(d,function(b,c){a.setAttribute(b,c)});P.traverse(a,function(b){var d=b.getAttribute("data-dynajot-id");d&&(P.set_node_id(b,d),b.removeAttribute("data-dynajot-id"),wa.updateState(a,b,c),Db.set(b,"seen",!0))})}else P.traverse(a,function(b){P.isTextNode(b)||(b=wa.serializeNode(a,b,c),g.addDelta(b),j.send({kind:"delta",value:b}))});P.traverse(a,function(b){wa.updateState(a,
b,c)});var f={},h=function(a){return C.map(a,function(a){try{return a.toString()}catch(b){console.log(a)}}).join("-")},l=Bb.appliesDeltas(a,c,q);s.delta.addReader(function(a){var c=h(a.message_id);f[c]||(f[c]=!0,a=g.changeset(a),C.each(a,l),b.onDelta&&C.each(a,b.onDelta))});wa.changes(a,c,function(a){if(!C.isEmpty(a)){a=C.clone(a);a.message_id=Ja.message_id(c);f[h(a.message_id)]=!0;g.addDelta(a);if(b.onChange)b.onChange(a);j.send({kind:"delta",value:a})}});if("function"==typeof b.onConnect)b.onConnect()}))};
ha.module$exports=ia;ha.module$exports&&(ha=ha.module$exports);window.dynajot=ha})();
